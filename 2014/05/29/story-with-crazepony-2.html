<!DOCTYPE html>
<html>
<head>
    <!--
    * Author:         BeiYuu
    -->
    <meta charset="utf-8" />
    <title>Crazepony博客</title>
    <meta name="author" content="crazepony" />
    <meta name="renderer" content="webkit">
    <meta name="description" content="Crazepony博客" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <link rel="stylesheet" href="/assets/css/blog-default.css" type="text/css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="alternate" type="application/atom+xml" title="Recent Entries" href="" />
    <script src="/assets/js/jquery-1.7.1.min.js" type="text/javascript"></script>

    <link href="/dist/css/bootstrap.css" rel="stylesheet">
    <link href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.css" rel="stylesheet">
</head>
<body>

    <a class="sr-only" href="#content">Skip to main content</a>

    <!-- Docs master nav -->
    <header class="navbar navbar-fixed-top navbar-inverse navbar-static-top" id="top" role="banner">
  <div class="container">
    <div class="navbar-header">
      <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".bs-navbar-collapse">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a href="/blog.html" class="navbar-brand">Crazepony 博客</a>
    </div>
    <nav class="collapse navbar-collapse bs-navbar-collapse" role="navigation">
      <ul class="nav navbar-nav">
        <li>
          <a href="/blog.html">主页</a>
        </li>
        <li>
          <a href="/blog-archive.html">归档</a>
        </li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li><a href="/index.html" >返回Crazepony主站</a></li>
      </ul>
    </nav>
  </div>
</header>

    <div class="home-menu">
        <div class="home-icon-con">
        </div>
        <div class="home-contact">
            <a href="http://weibo.com/beiyuu/" target="_blank" style="margin-left:-5px;"><img src="http://www.weibo.com/favicon.ico" alt="" width="25"/></a>
            <a href="http://www.douban.com/people/beiyuu/" target="_blank" style="text-align:center;"><img src="http://www.douban.com/favicon.ico" alt="" width="22"/></a>
            <a href="http://instagram.com/beiyuu/" target="_blank" style="text-align:right"><img src="http://d36xtkk24g8jdx.cloudfront.net/bluebar/00c6602/images/ico/favicon.ico" alt="" width="22"/></a>
        </div>
    </div>

    <link rel="stylesheet" href="/assets/js/prettify/prettify.css" />
<style type="text/css">
    body { background:#e8e8e8; }
    @media screen and (max-width: 750px){
        body { background:#fff; }
    }
    @media screen and (max-width: 1020px){
        body { background:#fff; }
    }
</style>

<div id="content">
    <div class="entry">
        <h1 class="entry-title"><a href="/2014/05/29/story-with-crazepony-2.html" title="我和Crazepony的那点事儿(2)">我和Crazepony的那点事儿(2)</a></h1>
        <p class="entry-date"><i class="fa fa-calendar fa-1x"></i>&nbsp;2014-05-29 &nbsp; &nbsp; &nbsp; &nbsp; <i class="fa fa-user fa-1x"></i>&nbsp;CamelGo</p>

        <p>最近笔者忙于毕业事宜,博客没跟上…</p>

<p>上次说到机身硬件就停笔了，莫非是给以后留点故事来写罢了，好吧废话不多说了，那么就开始吧</p>

<h1 id="section">（一）</h1>

<p>首先谈谈硬件选型的依据吧：</p>

<h2 id="section-1">主控方面：</h2>
<p>曾经在犹豫用TI的430系列单片机还是意法半导的STM32。那是在我大二的时候，从来没有接触过STM32，以前都是用51单片机和TI的msp430系列单片机。好吧，我承认了，我做Crazepony其实是就是为了学习STM32的，没有买过STM32相关的开发板，就这么简单粗暴大刀阔斧的开始了我的STM32之旅…</p>

<p>最终选择用STM32当然还有其他原因，TI公司的MSP430系列都是基于低功耗在做文章，作为移动消费电子，对电源续航能力要求比较高的场合比较适用。</p>

<p>而意法半导的大部分单片机都是ARM架构体系下的Cortex内核为基础的单片机，这里有必要啰嗦一下何谓Cortex架构：</p>

<p><img src="/assets/img/arm.png" alt="" /></p>

<p>英国的ARM公司在经典处理器ARM11架构之后，为了给不同需求的CPU厂商提供服务，之后的内核架构命名都改为Cortex，并分成了A,R,M三类,也即将ARM的三个字母拆分为三个架构的名，代表着不同的发展方向：</p>

<ul>
  <li>A系列处理器可托管丰富的OS平台和位应用商提供全方位的解决方案，诸如低成本手机、数字电视、机顶盒、打印机、服务器等</li>
  <li>R系列为实时处理器，要求可靠性、可用性、可维护性和实时响应的嵌入式系统提供解决方案</li>
  <li>M系列是一系列可向上兼容的高效能、易于使用的处理器，这些处理器旨在帮助开发者满足将来嵌入式的需要，这些需要包括低成本、不断增加的连接、代码改善移植等。M系列主要应用在智能测量、人机接口设备、汽车电子、工业控制、大型家电等。</li>
</ul>

<p><img src="/assets/img/cortex.png" alt="" /></p>

<p>很显然，苹果公司的A系列CPU也是嵌入的Cortex内核。</p>

<p>之所以选择STM32F103T8U6作为Crazepony的主控芯片。首先因为他是crotex-M3内核，继承了ARM的优良性能，主频能跑到72MHz，3个通用定时器，1个高级定时器，7通道DMA控制器，而且总线接口资源丰富；其次是因为它VFQFPN36的封装，只有6mm*6mm的占地面积,对这个寸土寸金的项目来说简直太赞了。这么高的性价比，当然让我选择了他作为主控。72MHz虽然生不了孩纸，但是足以处理除了图像之外的大部分任务了。</p>

<h2 id="section-2">传感器方面：</h2>

<p>目前Crazepony采用的是最常用的MPU6050陀螺仪加速度计一体芯片，成本不超过20元，对小四轴来说，它的精度和性能绰绰有余了（当我听说教研室师兄用的一颗传感器裸片卖1W+时，我整个人都不好了..），MPU6050在这个价位里面几乎是占有绝对的性价比优势。首先，它将陀螺仪和加速计整合在一个片上，通过IIC总线给出六个维度的ADC值；其次，芯片本身提供一个“从”IIC接口，供用户接第三方的IIC器件，一般选择是接一个电子罗盘，如HMC5883L,构成一个9轴的输出的姿态模组,现在MPU9150已经丧心病狂的把电子罗盘功能也整合在片上了,但是要买60+元；最后，这颗芯片内部集成了一个DMP（Digital Motion Processor）处理器，这是最让我爱不释手夜不能寐的一个功能,直接硬件解算四元数,从某种程度上说解放了20%的主控资源 </p>

<h2 id="section-3">数据通信方面：</h2>
<p>数据通信这块，也没什么特别要考虑的，短距离高速通信且免费这一点要求就限制了只能选择2.4GHz这个频段，在这个频段出了很多优秀的芯片厂商。在学生时代，我用得最多是Nordic公司的NRF24L01这个系列的收发一体芯片，由于刚开始着手启动Crazepony这个项目时，我只会这颗操作芯片，本着方便的原则，所以很自然的选择了这颗它（后来发现国外一个团队bitcraze也用的这个系列的芯片时，还是有点小激动的,不同的是，crazyfile用的是NRF24LU1，这颗芯片在与USB的接口上要容易些）</p>

<p><img src="/assets/img/nrf24l01.png" alt="" /></p>

<p>差不多了，硬件芯片选型大概是这样。下面谈谈这期间的一些细节</p>

<h1 id="section-4">（二）</h1>

<p>一个处女座仅仅是要求机身上芯片封装统一是QFN有错么,不要再黑处女座了好么，他们活得很累的。(~.~)</p>

<h2 id="section-5">机身外形:</h2>

<p>如上一篇博客谈到到的，我前前后后花了两年时间，以学习STM32这款单片为目的开始着手一个完全陌生的飞行器，从硬件到软件。可以想象，这两年我因为无知所走的弯路和画废掉的板子以及烧掉的生活费，加起来能换多少个菜包子和素馒头了。</p>

<p>机身外形的设计对我来说是最头大的，一直想不到什么好的主意，最关键的是我本人是天线专业的，我自以为是的把2.4G的天线露在机身外部（如图1），凸显我是学过天线设计的男人。但是这严重破坏了美感不说，还强烈的刺激了处女座的用户。一次偶然的机会拆了一个平板电脑，发现主板上有根长得很像电容贴片电容的元件，百度后才发现，居然是一根2.4G的陶瓷天线，这….我这四年天线专业的所学算是全部还给老师了。于是，后来再参考了某公司的某飞行器外形，压缩了天线，有了最终双曲线过度的Crazepony外形（如图2）</p>

<p><img src="/assets/img/crazepony-2013.png" alt="" />
<img src="/assets/img/crazepony-2014.png" alt="" /></p>

<h2 id="section-6">调试方便的考虑:</h2>

<p>在第三版之前,我都是用的stm32的SWD接口烧写调试固件代码,这种方式的确比较方便和有效,但是有个致命的弊端就是需要外接一个硕大的jlink调试器,这种设计简直太反人类了。纠结了好长时间，后来在看datasheet时发现STM32支持另外一种下载模式，用串口即可完成代码的下载，不足是不能在线调试。但是相比于能简化操作的诱惑，我还是决定在机身整合这样一个下载电路。（如图）</p>

<p>这样一来，机身和外部的有线接口就只有一根安卓手机的标配数据线mircoUSB线。它既是充电线，也是调参、烧写固件的数据线。这对大妈来说，想必操作也是很简单的吧</p>

<p><img src="/assets/img/crazepony-usb.png" alt="" /></p>

<h2 id="section-7">电机驱动:</h2>
<p>由于笔者完全是由于一种强烈的爱好选择了飞行器,最开始连有刷电机和无刷电机的物理结构区别都不知道,电调又是啥?傻傻分不清楚…</p>

<p>从一个几乎零基础的状态去选择电机驱动芯片，弯路是必须要走的，学费是必须要交的。曾以为书上学到的东西马上就能用，马上能转化为产品，后来发现真的是自己想多了。</p>

<p>最开始用的三极管作为电机驱动，采用很经典的共射电路“三极管工作在开关状态应该就行了吧？”画了用三极管驱动的PCB板，发现电机越转越慢，根本没劲。“也许是因为三极管扛不了大电流，好吧那我换个中功率管吧，集电极最大6A电流行了吧？”可以想象结果是不行的</p>

<p>首先了解下为什么三极管作为简单的电机驱动是不可取的方案：</p>

<ul>
  <li>三极管作为一个古老的半导体先驱，它是以一个放大器件的姿态而出现的，它在线性区域特性集中，饱和与截止都是两种极端的工作状态，而作为电机驱动的话，我们只能选择它的这两种极端工作模式</li>
  <li>用三极管作为大电流负载的驱动管时，不得不考虑的是他自身的管压降对负载的影响，这是很严重的。自身耗散越来越大，电机和管子是串联关系，电池电压只有3.7V，电机就只能越转越慢了</li>
</ul>

<p>在晶体管家族里面还有一种跟三极管特性互补的，所有特性都集中在开关状态的晶体管，场效应管，即MOSFET。通常的场效应管完全导通时，源漏极电阻都是mΩ级别的，即它自身的耗散非常小。用它做为驱动管再合适不过了。</p>

<p>最终选择了一个SOT23封装的,导通电压Vgs&lt;4v的场管（SI2302）,结果表现出了很好的驱动性能</p>

<pre><code>未完待续~~ 2014/5/29
</code></pre>


        <div id="disqus_container">
            <div style="margin-bottom:20px" class="right">
            </div>
            <a href="#" class="comment" onclick="return false;">点击查看评论</a>
            <div id="disqus_thread"></div>
        </div>
    </div>

    <div class="sidenav">
        <iframe width="100%" height="75" class="share_self"  frameborder="0" scrolling="no" ></iframe>
    </div>

    <div class="sidenav">
        <h2>Blog</h2>
        <ul class="artical-list">
        
            <li><a href="/2014/10/28/history-story-2.html">内部资料-Crazepony第二版改进部分</a></li>
        
            <li><a href="/2014/10/23/robot-dragonfly.html">扑翼飞行器Robot Dragonfly</a></li>
        
            <li><a href="/2014/10/22/powerup-paper-airplane.html">遥控纸飞机Powerup</a></li>
        
            <li><a href="/2014/09/19/crazepony-computer-vision.html">CrazePony与计算机视觉</a></li>
        
            <li><a href="/2014/09/15/crazepony-issuse-feedback.html">Crazepony四轴飞行器反馈问题修改记</a></li>
        
            <li><a href="/2014/08/20/self-balancing-vehicle.html">Crazepony自平衡小车</a></li>
        
            <li><a href="/2014/08/01/makeblock-weekend.html">Makeblock创客马拉松比赛纪实</a></li>
        
            <li><a href="/2014/07/31/diy-quadcopter.html">DIY四轴飞行器如何入门？</a></li>
        
            <li><a href="/2014/07/23/openrov.html">水中智能机器人OpenROV</a></li>
        
            <li><a href="/2014/07/22/crazepov-story.html">电子设计中POV的故事</a></li>
        
            <li><a href="/2014/07/14/crazepov.html">CrazePOV第二版</a></li>
        
            <li><a href="/2014/07/13/three-body.html">何时能再看一遍——三体</a></li>
        
            <li><a href="/2014/07/07/story-with-crazepony-3.html">我和Crazepony的那点事儿(3)</a></li>
        
            <li><a href="/2014/07/06/adult-science.html">《大人的科学》引起的思考</a></li>
        
            <li><a href="/2014/05/29/story-with-crazepony-2.html">我和Crazepony的那点事儿(2)</a></li>
        
            <li><a href="/2014/05/28/what-is-open-hardware.html">什么是开源硬件</a></li>
        
            <li><a href="/2014/05/20/what-is-maker.html">什么是创客</a></li>
        
            <li><a href="/2014/03/05/story-with-crazepony-1.html">我和Crazepony的那点事儿(1)</a></li>
        
        </ul>

    </div>
</div>

<script src="/assets/js/post.js" type="text/javascript"></script>


    <!--*********************************************************-->
    <!--****** 宝贝儿，看见这个时候，删掉下面的统计代码哦~ ******-->
    <!--************* 再推荐下我的第一篇博客哦~~ ****************-->
    <!--*********************************************************-->

    <div class="hide">
        <script type="text/javascript" src="http://js.tongji.linezing.com/3498918/tongji.js"></script>
        <noscript><a href="http://www.linezing.com"><img src="http://img.tongji.linezing.com/3498918/tongji.gif"/></a></noscript>
    </div>
    <script type="text/javascript">
        $(function(){
            $('.home-follow').click(function(e){
                e.preventDefault();

                if($('.home-contact').is(':visible')){
                    $('.home-contact').slideUp(100);
                }else{
                    $('.home-contact').slideDown(100);
                }
            });
        })
    </script>
</body>
</html>
